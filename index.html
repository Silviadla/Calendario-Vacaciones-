<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calendario Vacaciones</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    #calendar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .month { border: 1px solid #ccc; padding: 10px; border-radius: 8px; }
    .month h3 { text-align: center; margin: 5px 0; }
    .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
    .day { padding: 5px; text-align: center; border-radius: 4px; cursor: pointer; }
    .empty { background: #f9f9f9; cursor: default; }
    .vacaciones { background-color: lightgreen; }
    .medico { background-color: lightblue; }
    .festivo-nacional { background-color: lightcoral; color: white; }
    .festivo-local { background-color: orange; color: white; }
    #summary { margin-top: 20px; text-align: center; }
    #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
             background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    #modal-content { background: white; padding: 20px; border-radius: 8px; min-width: 200px; }
  </style>
</head>
<body>
  <h1>Calendario de Vacaciones</h1>

  <div style="text-align:center; margin-bottom:1rem;">
    <button onclick="changeYear(-1)">⏮ Año anterior</button>
    <span id="yearLabel" style="font-weight:bold; margin:0 1rem;"></span>
    <button onclick="changeYear(1)">Año siguiente ⏭</button>
  </div>

  <div id="calendar"></div>

  <div id="summary">
    <p>Días de vacaciones usados: <span id="vacacionesCount">0</span></p>
    <p>Días médicos usados: <span id="medicoCount">0</span></p>
    <p>Días de vacaciones restantes: <span id="restantesCount">22</span></p>
  </div>

  <!-- Modal para selección de tipo de día -->
  <div id="modal">
    <div id="modal-content">
      <h3>Selecciona tipo de día</h3>
      <label><input type="checkbox" id="chkVacaciones"> Vacaciones</label><br>
      <label><input type="checkbox" id="chkMedico"> Médico</label><br><br>
      <button onclick="applySelection()">Aceptar</button>
      <button onclick="closeModal()">Cancelar</button>
    </div>
  </div>

  <script>
    const calendar = document.getElementById("calendar");
    const vacacionesCountEl = document.getElementById("vacacionesCount");
    const medicoCountEl = document.getElementById("medicoCount");
    const restantesCountEl = document.getElementById("restantesCount");

    let vacacionesCount = 0;
    let medicoCount = 0;
    const totalVacaciones = 22;

    let currentYear = new Date().getFullYear();
    let shownYear = currentYear;

    // === Festivos nacionales fijos y variables ===
    function getEasterDate(year) {
      const f = Math.floor,
        G = year % 19,
        C = f(year / 100),
        H = (C - f(C / 4) - f((8 * C + 13) / 25) + 19 * G + 15) % 30,
        I = H - f(H / 28) * (1 - f(29 / (H + 1)) * f((21 - G) / 11)),
        J = (year + f(year / 4) + I + 2 - C + f(C / 4)) % 7,
        L = I - J,
        month = 3 + f((L + 40) / 44),
        day = L + 28 - 31 * f(month / 4);
      return new Date(year, month - 1, day);
    }

    function getNationalHolidays(year) {
      const holidays = [];
      const fixed = [
        [1, 1], [1, 6], [5, 1], [8, 15],
        [10, 12], [11, 1], [12, 6], [12, 8], [12, 25]
      ];
      fixed.forEach(([m, d]) => holidays.push(`${year}-${m}-${d}`));

      const easter = getEasterDate(year);
      const goodFriday = new Date(easter);
      goodFriday.setDate(easter.getDate() - 2);
      holidays.push(`${goodFriday.getFullYear()}-${goodFriday.getMonth() + 1}-${goodFriday.getDate()}`);

      return holidays;
    }

    // === Festivos autonómicos/locales ===
    function getLocalHolidays(year) {
      const holidays = [];

      // Día de Castilla y León
      holidays.push(`${year}-4-23`);

      // San Froilán (siempre 5 de octubre en León capital)
      holidays.push(`${year}-10-5`);

      // Ejemplo: traslados o festivos especiales
      if (year === 2025) {
        holidays.push(`${year}-10-13`); // Traslado Fiesta Nacional 2025
      }

      return holidays;
    }

    let nationalHolidays = new Set(getNationalHolidays(currentYear));
    let localHolidays = new Set(getLocalHolidays(currentYear));

    // Generar calendario
    function createCalendar(year) {
      calendar.innerHTML = "";
      document.getElementById("yearLabel").textContent = year;

      for (let m = 0; m < 12; m++) {
        const monthDiv = document.createElement("div");
        monthDiv.className = "month";

        const monthName = new Date(year, m).toLocaleString("es-ES", { month: "long" });
        monthDiv.innerHTML = `<h3>${monthName}</h3>`;

        const daysDiv = document.createElement("div");
        daysDiv.className = "days";

        const firstDay = new Date(year, m, 1).getDay();
        const start = firstDay === 0 ? 6 : firstDay - 1;
        const lastDate = new Date(year, m + 1, 0).getDate();

        for (let i = 0; i < start; i++) {
          const empty = document.createElement("div");
          empty.className = "day empty";
          daysDiv.appendChild(empty);
        }

        for (let d = 1; d <= lastDate; d++) {
          const day = document.createElement("div");
          day.className = "day";
          day.textContent = d;

          const dateKey = `${year}-${m + 1}-${d}`;
          if (nationalHolidays.has(dateKey)) day.classList.add("festivo-nacional");
          if (localHolidays.has(dateKey)) day.classList.add("festivo-local");

          day.onclick = () => openModal(day);
          daysDiv.appendChild(day);
        }

        monthDiv.appendChild(daysDiv);
        calendar.appendChild(monthDiv);
      }

      updateCounters();
    }

    // Modal
    let selectedDay = null;
    function openModal(dayEl) {
      selectedDay = dayEl;
      document.getElementById("chkVacaciones").checked = dayEl.classList.contains("vacaciones");
      document.getElementById("chkMedico").checked = dayEl.classList.contains("medico");
      document.getElementById("modal").style.display = "flex";
    }
    function closeModal() {
      document.getElementById("modal").style.display = "none";
      selectedDay = null;
    }
    function applySelection() {
      if (!selectedDay) return;
      selectedDay.classList.remove("vacaciones", "medico");
      if (document.getElementById("chkVacaciones").checked) {
        selectedDay.classList.add("vacaciones");
      }
      if (document.getElementById("chkMedico").checked) {
        selectedDay.classList.add("medico");
      }
      closeModal();
      updateCounters();
    }

    // Contadores
    function updateCounters() {
      const allDays = document.querySelectorAll(".day");
      vacacionesCount = 0;
      medicoCount = 0;

      allDays.forEach(day => {
        if (day.classList.contains("vacaciones")) vacacionesCount++;
        if (day.classList.contains("medico")) medicoCount++;
      });

      vacacionesCountEl.textContent = vacacionesCount;
      medicoCountEl.textContent = medicoCount;
      restantesCountEl.textContent = totalVacaciones - vacacionesCount;
    }

    // Cambio de año
    function changeYear(offset) {
      shownYear += offset;
      nationalHolidays = new Set(getNationalHolidays(shownYear));
      localHolidays = new Set(getLocalHolidays(shownYear));
      createCalendar(shownYear);
    }

    createCalendar(currentYear);
  </script>
</body>
</html>
