<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calendario Vacaciones</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; margin: 0; padding: 1rem; }
    h1 { text-align: center; margin-bottom: 0.5rem; }
    .counters { text-align: center; margin-bottom: 1rem; }
    .calendar { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
    .month { background: white; border-radius: 10px; padding: 0.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .month h2 { text-align: center; margin-top: 0; }
    .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; font-size: 0.8rem; }
    .day { border: 1px solid #ccc; padding: 0.4rem; text-align: center; cursor: pointer; border-radius: 4px; }
    .vacation { background-color: #FFCC80; }
    .medical { background-color: #90CAF9; }
    .holiday-national { background-color: #F28B82; cursor: default !important; }
    .holiday-local { background-color: #E1BEE7; cursor: default !important; }
    .today { border: 2px solid #3f51b5; }
    .labels { display: flex; justify-content: center; gap: 1rem; margin-bottom: 1rem; font-size: 0.9rem; flex-wrap: wrap; }
    .labels span { display: inline-flex; align-items: center; gap: 0.3rem; }
    .dot { width: 1rem; height: 1rem; border-radius: 50%; display: inline-block; }
    .vacation-dot { background: #FFCC80; }
    .medical-dot { background: #90CAF9; }
    .holiday-national-dot { background: #F28B82; }
    .holiday-local-dot { background: #E1BEE7; }
    .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; }
    .modal-content { background:white; padding:1rem; border-radius:8px; width:250px; text-align:center; }
    .modal button { margin-top:0.5rem; padding:0.3rem 0.8rem; }
  </style>
</head>
<body>
  <h1>Calendario Vacaciones</h1>
  <div class="counters">
    <p id="vacationCount">Días de vacaciones usados: 0</p>
    <p id="medicalCount">Días médicos: 0</p>
    <p id="remaining">Vacaciones restantes: 23</p>
  </div>
  <div class="labels">
    <span><span class="dot vacation-dot"></span> Vacaciones</span>
    <span><span class="dot medical-dot"></span> Médico</span>
    <span><span class="dot holiday-national-dot"></span> Festivo Nacional</span>
    <span><span class="dot holiday-local-dot"></span> Festivo Local (León)</span>
  </div>
  <div style="text-align:center; margin-bottom: 1rem;">
    <button onclick="changeYear(-1)">⬅️ Año anterior</button>
    <span id="yearLabel"></span>
    <button onclick="changeYear(1)">Año siguiente ➡️</button>
  </div>
  <div class="calendar" id="calendar"></div>

  <!-- Modal -->
  <div class="modal" id="typeModal">
    <div class="modal-content">
      <p>Selecciona tipo de día:</p>
      <label><input type="checkbox" id="chkVacation"> Vacaciones</label><br>
      <label><input type="checkbox" id="chkMedical"> Médico</label><br>
      <button onclick="applyDayType()">Aceptar</button>
      <button onclick="closeModal()">Cancelar</button>
    </div>
  </div>

  <script>
    const calendar = document.getElementById("calendar");
    let currentYear = new Date().getFullYear();
    const vacationLimit = 23;
    let selectedDayDiv = null;

    const months = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
    const dayNames = ["L","M","X","J","V","S","D"];

    function getFixedHolidays(year) {
      return new Set([
        `${year}-1-1`,   // Año Nuevo
        `${year}-1-6`,   // Reyes
        `${year}-5-1`,   // Trabajo
        `${year}-8-15`,  // Asunción
        `${year}-10-12`, // Fiesta Nacional
        `${year}-11-1`,  // Todos los Santos
        `${year}-12-6`,  // Constitución
        `${year}-12-8`,  // Inmaculada
        `${year}-12-25`  // Navidad
      ]);
    }

    function getEasterSunday(year) {
      let f = Math.floor,
          a = year % 19,
          b = f(year / 100),
          c = year % 100,
          d = f(b / 4),
          e = b % 4,
          g = f((8 * b + 13) / 25),
          h = (19 * a + b - d - g + 15) % 30,
          i = f(c / 4),
          k = c % 4,
          l = (32 + 2 * e + 2 * i - h - k) % 7,
          m = f((a + 11 * h + 19 * l) / 433),
          n = f((h + l - 7 * m + 90) / 25),
          p = (h + l - 7 * m + 33 * n + 19) % 32;
      return new Date(year, n - 1, p);
    }

    function getEasterRelated(year) {
      const easter = getEasterSunday(year);
      const thur = new Date(easter);
      thur.setDate(easter.getDate() - 3);
      const fri = new Date(easter);
      fri.setDate(easter.getDate() - 2);
      return new Set([
        `${year}-${thur.getMonth()+1}-${thur.getDate()}`,
        `${year}-${fri.getMonth()+1}-${fri.getDate()}`
      ]);
    }

    function getLocalHolidays(year) {
      const holidays = new Set();
      if (year === 2026) {
        // Solo San Froilán como festivo local de León (ejemplo)
        holidays.add(`${year}-10-5`);  // San Froilán trasladado al lunes 5 octubre 2026
      }
      // si tienes otros días locales, los agregas aquí
      return holidays;
    }

    function createCalendar(year) {
      document.getElementById("yearLabel").textContent = year;
      calendar.innerHTML = "";

      const today = new Date();
      const national = getFixedHolidays(year);
      const easter = getEasterRelated(year);
      const local = getLocalHolidays(year);

      for (let m = 0; m < 12; m++) {
        const firstDay = new Date(year, m, 1).getDay();
        const totalDays = new Date(year, m + 1, 0).getDate();
        const monthDiv = document.createElement("div");
        monthDiv.className = "month";
        const title = document.createElement("h2");
        title.textContent = months[m];
        monthDiv.appendChild(title);

        const daysDiv = document.createElement("div");
        daysDiv.className = "days";

        dayNames.forEach(d => {
          const label = document.createElement("div");
          label.className = "day";
          label.style.fontWeight = "bold";
          label.textContent = d;
          daysDiv.appendChild(label);
        });

        const startDay = (firstDay + 6) % 7;
        for (let i = 0; i < startDay; i++) {
          daysDiv.appendChild(document.createElement("div"));
        }

        for (let d = 1; d <= totalDays; d++) {
          const dateKey = `${year}-${m+1}-${d}`;
          const dayDiv = document.createElement("div");
          dayDiv.className = "day";
          dayDiv.textContent = d;

          if (national.has(dateKey) || easter.has(dateKey)) {
            dayDiv.classList.add("holiday-national");
          } else if (local.has(dateKey)) {
            dayDiv.classList.add("holiday-local");
          } else {
            dayDiv.addEventListener("click", () => openModal(dayDiv));
          }

          if (year === today.getFullYear() && m === today.getMonth() && d === today.getDate()) {
            dayDiv.classList.add("today");
          }

          daysDiv.appendChild(dayDiv);
        }

        monthDiv.appendChild(daysDiv);
        calendar.appendChild(monthDiv);
      }
      updateCounters();
    }

    function openModal(dayDiv) {
      selectedDayDiv = dayDiv;
      document.getElementById("chkVacation").checked = dayDiv.classList.contains("vacation");
      document.getElementById("chkMedical").checked = dayDiv.classList.contains("medical");
      document.getElementById("typeModal").style.display = "flex";
    }
    function closeModal() { document.getElementById("typeModal").style.display = "none"; }
    function applyDayType() {
      if (!selectedDayDiv) return;
      selectedDayDiv.classList.remove("vacation","medical");
      if (document.getElementById("chkVacation").checked) selectedDayDiv.classList.add("vacation");
      if (document.getElementById("chkMedical").checked) selectedDayDiv.classList.add("medical");
      closeModal();
      updateCounters();
    }

    function updateCounters() {
      const vacationDays = document.querySelectorAll(".vacation").length;
      const medicalDays = document.querySelectorAll(".medical").length;
      document.getElementById("vacationCount").textContent = "Días de vacaciones usados: " + vacationDays;
      document.getElementById("medicalCount").textContent = "Días médicos: " + medicalDays;
      document.getElementById("remaining").textContent = "Vacaciones restantes: " + (vacationLimit - vacationDays);
    }

    function changeYear(offset) {
      currentYear += offset;
      createCalendar(currentYear);
    }

    // Inicial
    createCalendar(currentYear);
  </script>
</body>
</html>
