<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendario Vacaciones</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f0f8ff; padding: 1rem; }
    h1, .year-selector, .counters, .labels { text-align: center; margin-bottom: 1rem; }
    .calendar { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
    .month { background: #fff; border-radius: 10px; padding: 0.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .month h2 { text-align: center; margin-top: 0; }
    .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; font-size: 0.8rem; }
    .day { border: 1px solid #ccc; padding: 0.4rem; text-align: center; border-radius: 4px; cursor: pointer; }
    .vacation { background-color: #FFCC80; }
    .medical { background-color: #90CAF9; }
    .carryover { background-color: #FFD700; cursor: not-allowed; }
    .weekend { background-color: #EEEEEE; }
    .today { border: 2px solid #3f51b5; }
    .labels span { display: inline-flex; align-items: center; gap: 0.3rem; margin: 0 0.5rem; }
    .vacation-dot, .medical-dot, .carryover-dot, .weekend-dot {
      width: 1rem; height: 1rem; border-radius: 50%; display: inline-block;
    }
    .vacation-dot { background-color: #FFCC80; }
    .medical-dot { background-color: #90CAF9; }
    .carryover-dot { background-color: #FFD700; }
    .weekend-dot { background-color: #EEEEEE; }
  </style>
</head>
<body>
  <h1>Calendario Vacaciones</h1>
  <div class="year-selector">
    <button id="prevYear">« Año anterior</button>
    <input type="number" id="yearInput" value="2025" min="2000" max="2100" style="width:80px; text-align:center;">
    <button id="nextYear">Año siguiente »</button>
  </div>
  <div class="counters">
    <p id="vacationCount">Días de vacaciones usados: 0</p>
    <p id="medicalCount">Días médicos: 0</p>
    <p id="carryoverCount">Vacaciones arrastradas del año anterior: 0</p>
    <p id="remaining">Vacaciones restantes: 23</p>
  </div>
  <div class="labels">
    <span><span class="vacation-dot"></span> Vacaciones</span>
    <span><span class="medical-dot"></span> Médico</span>
    <span><span class="carryover-dot"></span> Vacaciones arrastradas</span>
    <span><span class="weekend-dot"></span> Fin de semana</span>
  </div>
  <div class="calendar" id="calendar"></div>

  <script>
    let currentYear = new Date().getFullYear();
    const vacationLimit = 23;
    const vacationCount = document.getElementById("vacationCount");
    const medicalCount = document.getElementById("medicalCount");
    const carryoverCount = document.getElementById("carryoverCount");
    const remaining = document.getElementById("remaining");
    const yearInput = document.getElementById("yearInput");
    const calendar = document.getElementById("calendar");
    const dayNames = ["L", "M", "X", "J", "V", "S", "D"];
    const months = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
    let yearData = {};

    function createCalendar(year) {
      currentYear = year;
      yearInput.value = year;
      if (!yearData[year]) {
        yearData[year] = { vacation: new Set(), medical: new Set(), carryover: new Set() };
      }

      // Detectar y arrastrar vacaciones no usadas del año anterior
      const previousYear = year - 1;
      if (yearData[previousYear]) {
        const used = yearData[previousYear].vacation.size;
        const remainingDays = vacationLimit - used;
        if (remainingDays > 0) {
          for (let i = 1; i <= remainingDays; i++) {
            const dateKey = `${year}-1-${i}`; // Primeros días de enero
            yearData[year].carryover.add(dateKey);
          }
        }
      }

      calendar.innerHTML = "";
      for (let m = 0; m < 12; m++) {
        const firstDay = new Date(year, m, 1).getDay();
        const totalDays = new Date(year, m + 1, 0).getDate();
        const monthDiv = document.createElement("div");
        monthDiv.className = "month";
        const title = document.createElement("h2");
        title.textContent = months[m];
        monthDiv.appendChild(title);
        const daysDiv = document.createElement("div");
        daysDiv.className = "days";

        dayNames.forEach(d => {
          const label = document.createElement("div");
          label.className = "day";
          label.style.fontWeight = "bold";
          label.textContent = d;
          daysDiv.appendChild(label);
        });

        const startDay = (firstDay + 6) % 7;
        for (let i = 0; i < startDay; i++) daysDiv.appendChild(document.createElement("div"));

        for (let d = 1; d <= totalDays; d++) {
          const dayDiv = document.createElement("div");
          dayDiv.className = "day";
          dayDiv.textContent = d;
          const dateKey = `${year}-${m + 1}-${d}`;
          const dayOfWeek = new Date(year, m, d).getDay();

          if (dateKey === getTodayKey()) dayDiv.classList.add("today");
          if (dayOfWeek === 0 || dayOfWeek === 6) dayDiv.classList.add("weekend");

          if (yearData[year].carryover.has(dateKey)) {
            dayDiv.classList.add("carryover");
          } else {
            dayDiv.addEventListener("click", () => handleDayClick(dayDiv, year, m, d));
          }

          if (yearData[year].vacation.has(dateKey)) dayDiv.classList.add("vacation");
          if (yearData[year].medical.has(dateKey)) dayDiv.classList.add("medical");

          daysDiv.appendChild(dayDiv);
        }

        monthDiv.appendChild(daysDiv);
        calendar.appendChild(monthDiv);
      }

      updateCounters();
    }

    function handleDayClick(dayDiv, year, month, day) {
      const dateKey = `${year}-${month + 1}-${day}`;
      const isVacation = dayDiv.classList.contains("vacation");
      const isMedical = dayDiv.classList.contains("medical");

      if (isVacation || isMedical) {
        dayDiv.classList.remove("vacation", "medical");
        yearData[year].vacation.delete(dateKey);
        yearData[year].medical.delete(dateKey);
      } else {
        const type = prompt("¿Qué quieres marcar? (v = vacaciones, m = médico)").toLowerCase();
        if (type === "v") {
          dayDiv.classList.add("vacation");
          yearData[year].vacation.add(dateKey);
        } else if (type === "m") {
          dayDiv.classList.add("medical");
          yearData[year].medical.add(dateKey);
        }
      }

      updateCounters();
    }

    function updateCounters() {
      const data = yearData[currentYear];
      vacationCount.textContent = "Días de vacaciones usados: " + data.vacation.size;
      medicalCount.textContent = "Días médicos: " + data.medical.size;
      carryoverCount.textContent = "Vacaciones arrastradas del año anterior: " + data.carryover.size;
      remaining.textContent = "Vacaciones restantes: " + (vacationLimit - data.vacation.size);
    }

    function getTodayKey() {
      const today = new Date();
      return `${today.getFullYear()}-${today.getMonth() + 1}-${today    }

    function getTodayKey() {
      const today = new Date();
      return `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
    }

    document.getElementById("prevYear").addEventListener("click", () => createCalendar(currentYear - 1));
    document.getElementById("nextYear").addEventListener("click", () => createCalendar(currentYear + 1));
    yearInput.addEventListener("change", () => createCalendar(parseInt(yearInput.value)));

    // Inicializar el calendario con el año actual
    createCalendar(currentYear);
  </script>
</body>
</html>
